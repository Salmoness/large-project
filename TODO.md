# TODO

- [x] Figma Website Prototype
- [x] Figma Mobile Prototype
- [x] Decide on Project Theme (Figma Prototype)
- [x] Decide on Project Name (Figma Prototype)
- [x] Gantt Chart
- [x] Entity Relationship Diagram for Database
- [x] Activity Diagram
- [ ] Mobile Application Class Diagram
- [ ] Mobile Application
- [ ] API for Account Password Recovery
- [x] API for Registration Email Verification
- [x] API for Account Registration
- [x] API for Account Login
- [x] API for Quiz Scoreboard
- [x] API for Quiz Browser
- [x] API for Quiz Generation with AI
- [x] API for Quiz Game (Start Quiz Session)
- [x] API for Quiz Game (Join Quiz Session)
- [x] API for Quiz Game (Submit Answer)
- [ ] Frontend for Account Password Recovery
- [x] Frontend for Quiz Browser
- [ ] Frontend for Quiz Scoreboard
- [x] Frontend for Quiz Game (Questions and Answers)
- [x] Frontend for Account Login
- [x] Frontend for Account Registration
- [x] Frontend for Registration Email Verification
- [ ] Improve scoring logic
- [x] Password Hashing
- [ ] 6 API Endpoint Unit Tests
- [ ] 3 Mobile Application Unit Tests
- [ ] Create Project Presentation
- [ ] Practice Project Presentation

## Known Issues

- [ ] NO PAGES ARE STYLED YET
- [ ] JWT are not validated in most functions (IMPORTANT)
- [x] NodeMailer does not work on DigitalOcean
- [ ] Logged in users are not redirected from /login to /home
- [ ] Logged out users are not redirected from /home to /login
- [x] Username should be unique for registration
- [x] Email should be unique for registration
- [ ] Email not recieved in user inbox

## Master Plan

### Page Flow

`/index`: has a `play` button (redirects to `/play`) and a `host` button (redirects to `/home` IF LOGGED IN, otherwise redirects to `/login` if NOT LOGGED IN)

`/home`: Protected page, must be logged in. This is the homepage for logged in users. Contains `log out`, `browse quizzes` (redirects to `/browse`), `play` (redirects to `/play`), `view my history` (redirects to `/history`), and `create quiz` (redirects to `/create`).

`/create`: Protected page, must be logged in. A form for creating a new quiz. Contains a TOPIC field. Upon successful generation, redirects to `/:quiz_id/host`.

`/login`: a form for logging in. Has a USERNAME and PASSWORD field. Also has a `register` button (redirects to `/register`). Also has a `forgot password` button (redirects to `/account/password-reset` page.)

`/account/password-reset`: a form for resetting the password. Has an EMAIL field. Upon submission, verify the email, and send a PASSWORD RESET EMAIL. Redirect to `/account/password-reset-email-sent`. This email contains a link (to `/account/password-reset/:token`) that the user uses to complete password recovery.

`/account/password-reset/:token`: a form that contains a NEW PASSWORD field. The page uses the token from the URL and the NEW PASSWORD field to complete the reset.

`/register`: a form for registering. Has a USERNAME, EMAIL, and PASSWORD field. Also has a `log in` button (redirects to `/login`). Upon submission, verify the form, and SEND A VERIFICATION EMAIL. Redirect to `/account/registration-email-sent`. This email contains a link (to `/account/registration-email-confirmation/:token`) that the user uses to complete registration. Usernames and emails must be unique.

`/play`: a form with a USERNAME field (only visible if the user is NOT LOGGED IN) and an ACCESS CODE field. Redirects to `/:quiz_game_id/play` upon submission, or `/:quiz_game_id/scoreboard` if the user is logged in and has already finished the quiz.

`/:quiz_game_id/play`: the interface for playing a quiz. Displays one question at a time and shows all available answers. User clicks a single answer per question to progress. On the final question, redirects to `/:quiz_game_id/scoreboard`.

`/:quiz_game_id/scoreboard`: displays a scrollable scoreboard of the submissions of a specific quiz. Each entry is that of someone who has completed the entire quiz. It is sorted by NUMBER-OF-CORRECT-ANSWERS, with tie breaking being determined by TIME-TAKEN. Each entry has a USERNAME. Has an `OK` button (redirects to `/index` if LOGGED OUT, otherwise redirects to `/host` if LOGGED IN).

`/browse`: Protected page, must be logged in. A scrollable table of quizzes generated by all users. Each table entry has a QUIZ NAME, QUIZ TOPIC, and QUIZ SUMMARY description. Each table entry also has a `host` button (redirects to `/:quiz_id/host`).

`/history`: Protected page, must be logged in. A scrollable table of quizzes this user has previously played. Each table entry has a QUIZ NAME. Each table entry also has a `scoreboard` button (redirects to `/:quiz_game_id/scoreboard`).

`/:quiz_id/host`: Protected page, must be logged in. displays QUIZ NAME, QUIZ TOPIC, and QUIZ SUMMARY description. Contains a button `launch`. When this button is pressed, a new quiz game is started. An `access code`is displayed, alongside a new button `play` (redirects to `/:quiz_game_id/play`).

### Clarifications

`:quiz_id` is `_id` from the database `Quizzes` table. When a quiz is generated, it is stored in this table. It contains only information about itself (topic, questions, answers, etc.)

`:quiz_game_id` is `_id` from the database `QuizGames` table. When a quiz is hosted, it is stored in this table. It contains an access code. This makes it so that a single generated quiz can be hosted more than once.

Guests can provide their own username for each quiz. No uniqueness for usernames is required. This is `guest_username` in the database `QuizSessions` table.

Quizzes will NOT have a time limit, per-user OR globally. Instead, TIME-STARTED is recorded when someone first begins a quiz, and TIME-FINISHED is recorded once the last question is submitted.

#### JWT Clarification

There are two separate JWTs. One for user authentication and another for quiztaking.

| JWT            | Field                                                          |
| -------------- | -------------------------------------------------------------- |
| authedUserJWT  | `authUserJWT.payload.userId` (`_id` from `Users`)              |
| quizSessionJWT | `quizSessionJWT.payload.sessionId` (`_id` from `QuizSessions`) |

`authedUserJWT` is used for: `generateQuiz`, `quizHistory`, `searchQuiz`, and `hostQuiz`.

`quizSessionJWT` is used for: `joinQuiz`, `playQuiz`, and `submitQuiz`.

No JWT is needed for `login`, `register`, `confirmEmail`, `recoverPassword`, `quizInfo`, and `viewQuizScoreboard`.

Why do it like this? This way, users and guests are treated the exact same while playing a quiz.

Currently undecided on if we should store `username`/`displayname`/other information inside the JWT. Technically, this information can be fetched from an API when needed, like the scoreboard.
